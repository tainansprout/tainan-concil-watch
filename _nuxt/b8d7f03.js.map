{"version":3,"sources":["webpack:///./components/DistrictMap.vue?ad11","webpack:///./components/DistrictMap.vue","webpack:///./components/DistrictMap.vue?d301","webpack:///./components/DistrictMap.vue?c884","webpack:///./components/DistrictMap.vue?0c3e","webpack:///./components/DistrictMap.vue?6158","webpack:///./components/DistrictMap.vue?c03b"],"names":["TOWN2DISTRICT","Object","values","districtMap","reduce","map","district","townList","forEach","town","endsWith","districtId","MAP_SIZE","TOOLTIP_WIDTH","TOOLTIP_CONFIG","LINE_START","第十二選區","第十三選區","LINE_OFFSET","default","第五選區","第八選區","第九選區","第十選區","BOARD_OFFSET","x","y","TOOLTIP_HEIGHT","props","focus","validator","val","includes","type","id","required","data","mapD3","watch","this","handleFocus","mounted","initMap","methods","selectAll","classed","selector","select","handleHoverBoard","e","d","$emit","name","handleOutBoard","handleHoverPath","properties","TOWNNAME","handleOutPath","gotoDistrictFromBoard","districtName","districtName2Id","$router","push","params","round","DEFAULT_ROUND","$route","gotoDistrict","mapEle","$refs","towns","feature","townMap","objects","features","projection","d3","fitSize","geoGenerator","svgEle","append","attr","enter","on","districts","tooltipLines","endPoint","centroid","lineDiff","boardOffset","quota","districtQuota","line","start","end","tooltipSvg","html","component","_h","$createElement","_c","_self","staticClass","ref","content","__esModule","module","i","locals","exports","add","___CSS_LOADER_EXPORT___","___CSS_LOADER_API_IMPORT___"],"mappings":"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","file":"b8d7f03.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"dmap relative\"},[_c('div',{ref:\"map\",staticClass:\"dmap__map absolute h-100 w-100\"})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n\nimport * as d3 from 'd3'\nimport { feature } from 'topojson-client'\nimport { DEFAULT_ROUND, districtName2Id } from '~/libs/defs'\nimport townMap from '~/content/map/town-2010.topo-districts.json'\nimport districtMap from '~/content/council/3rd/district-map.json'\n\nconst TOWN2DISTRICT = Object.values(districtMap).reduce((map, district) => {\n  district.townList.forEach((town) => {\n    town = town.endsWith('區') ? town : `${town}區`\n    map[town] = district.districtId\n  })\n  return map\n}, {})\n\nconst MAP_SIZE = 800\n\nconst TOOLTIP_WIDTH = 120\nconst TOOLTIP_HEIGHT = 87\nconst TOOLTIP_CONFIG = {\n  LINE_START: {\n    第十二選區: [630, 750],\n    第十三選區: [730, 650]\n  },\n  LINE_OFFSET: {\n    default: [0, -40],\n    第五選區: [0, -48],\n    第八選區: [-100, 20],\n    第九選區: [-45, 70],\n    第十選區: [25, 70]\n  },\n  BOARD_OFFSET: {\n    default: {\n      x: TOOLTIP_WIDTH * -1 / 2,\n      y: TOOLTIP_HEIGHT * -1 + 1\n    },\n    第八選區: {\n      x: TOOLTIP_WIDTH * -1 + 1,\n      y: TOOLTIP_HEIGHT * -1 / 2\n    },\n    第九選區: {\n      x: TOOLTIP_WIDTH * -1 + 2,\n      y: TOOLTIP_HEIGHT * -1 / 2\n    },\n    第十選區: {\n      x: TOOLTIP_WIDTH * -1 / 2,\n      y: -1\n    }\n  }\n}\n\nexport default {\n  props: {\n    focus: {\n      default: null,\n      validator (val) {\n        return !val || (['town', 'district'].includes(val.type) && val.id)\n      }\n    },\n    map: {\n      type: Object,\n      required: true\n    }\n  },\n  data () {\n    return {\n      mapD3: null\n    }\n  },\n  watch: {\n    focus () {\n      this.handleFocus()\n    }\n  },\n  mounted () {\n    this.initMap()\n  },\n  methods: {\n    handleFocus () {\n      if (!this.mapD3) {\n        return\n      }\n      this.mapD3.selectAll('g path.active').classed('active', false)\n      if (this.focus) {\n        const selector = `${this.focus.type}-${this.focus.id}`\n        this.mapD3.select(`g path.${selector}`).classed('active', true)\n      }\n    },\n    handleHoverBoard (e, d) {\n      this.$emit('hover-district', d.name)\n    },\n    handleOutBoard (e, d) {\n      this.$emit('out-district', d.name)\n    },\n    handleHoverPath (e, d) {\n      this.$emit('hover-town', d.properties.TOWNNAME)\n    },\n    handleOutPath (e, d) {\n      this.$emit('out-town', d.properties.TOWNNAME)\n    },\n    gotoDistrictFromBoard (e, d) {\n      const districtName = d.name\n      const districtId = districtName2Id(districtName)\n      this.$router.push({\n        name: 'round-district-district',\n        params: {\n          round: DEFAULT_ROUND,\n          ...this.$route.params,\n          district: districtId\n        }\n      })\n    },\n    gotoDistrict (e, d) {\n      const town = d.properties.TOWNNAME\n      const districtId = TOWN2DISTRICT[town]\n      this.$router.push({\n        name: 'round-district-district',\n        params: {\n          round: DEFAULT_ROUND,\n          ...this.$route.params,\n          district: districtId\n        }\n      })\n    },\n    initMap () {\n      const mapEle = this.$refs.map\n      const towns = feature(townMap, townMap.objects.towns).features\n\n      const projection = d3.geoMercator()\n        .fitSize([MAP_SIZE, MAP_SIZE], {\n          type: 'FeatureCollection',\n          features: towns\n        })\n\n      const geoGenerator = d3.geoPath(projection)\n\n      // create map\n      const svgEle = d3.select(mapEle)\n        .append('svg')\n        // Responsive SVG needs these 2 attributes and no width and height attr.\n        .attr('preserveAspectRatio', 'xMinYMin meet')\n        .attr('viewBox', `0 0 ${MAP_SIZE} ${MAP_SIZE}`)\n        .attr('xmlns:xhtml', 'http://www.w3.org/1999/xhtml')\n        .classed('svg-content', true)\n\n      this.mapD3 = svgEle\n\n      // draw town\n      const townSvg = svgEle\n        .append('g')\n        .attr('class', 'town')\n\n      townSvg.selectAll('path')\n        .data(towns)\n        .enter()\n        .append('path')\n        .attr('d', geoGenerator)\n        .attr('class', d => `town-${d.properties.TOWNNAME}`)\n        .on('mouseover', this.handleHoverPath)\n        .on('mouseout', this.handleOutPath)\n        .on('click', this.gotoDistrict)\n\n      // draw district\n      const districts = feature(townMap, townMap.objects.districts).features\n      const districtSvg = svgEle\n        .append('g')\n        .attr('class', 'district')\n\n      districtSvg.selectAll('path')\n        .data(districts)\n        .enter()\n        .append('path')\n        .attr('d', geoGenerator)\n        .attr('class', d => `district-${districtName2Id(d.properties.name)}`)\n\n      // draw district tooltip\n      const allDistricts = [\n        ...districts,\n        { properties: { name: '第十二選區' } },\n        { properties: { name: '第十三選區' } }\n      ]\n      const tooltipLines = allDistricts.map((d) => {\n        const name = d.properties.name\n        const endPoint = d.type ? geoGenerator.centroid(d) : TOOLTIP_CONFIG.LINE_START[name]\n        const lineDiff = TOOLTIP_CONFIG.LINE_OFFSET[name] || TOOLTIP_CONFIG.LINE_OFFSET.default\n        const boardOffset = TOOLTIP_CONFIG.BOARD_OFFSET[name] || TOOLTIP_CONFIG.BOARD_OFFSET.default\n        const quota = this.map[districtName2Id(name)].districtQuota\n        return {\n          name,\n          quota,\n          line: {\n            start: [endPoint[0] + lineDiff[0], endPoint[1] + lineDiff[1]],\n            end: endPoint\n          },\n          boardOffset\n        }\n      })\n\n      const line = d3.line()\n      const tooltipSvg = svgEle\n        .append('g')\n        .attr('class', 'tooltip')\n\n      tooltipSvg.selectAll('path')\n        .data(tooltipLines)\n        .enter()\n        .append('path')\n        .attr('d', d => line([d.line.start, d.line.end]))\n\n      const board = tooltipSvg.selectAll('foreignObject')\n        .data(tooltipLines)\n        .enter()\n        .append('foreignObject')\n        .attr('x', d => d.line.start[0] + d.boardOffset.x)\n        .attr('y', d => d.line.start[1] + d.boardOffset.y)\n        .attr('width', TOOLTIP_WIDTH)\n        .attr('height', TOOLTIP_HEIGHT)\n\n      board.append('xhtml:div')\n        .attr('class', 'board')\n        .html(d => `<div class=\"board__title\">${d.name}</div><div class=\"board__quota\">${d.quota}</div>`)\n        .on('mouseover', this.handleHoverBoard)\n        .on('mouseout', this.handleOutBoard)\n        .on('click', this.gotoDistrictFromBoard)\n    }\n  }\n}\n","import mod from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./DistrictMap.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./DistrictMap.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DistrictMap.vue?vue&type=template&id=3e69313a&scoped=true&lang=pug&\"\nimport script from \"./DistrictMap.vue?vue&type=script&lang=js&\"\nexport * from \"./DistrictMap.vue?vue&type=script&lang=js&\"\nimport style0 from \"./DistrictMap.vue?vue&type=style&index=0&id=3e69313a&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3e69313a\",\n  null\n  \n)\n\nexport default component.exports","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./DistrictMap.vue?vue&type=style&index=0&id=3e69313a&lang=scss&scoped=true&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"14606cb6\", content, true, {\"sourceMap\":false});","export * from \"-!../node_modules/vue-style-loader/index.js??ref--7-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./DistrictMap.vue?vue&type=style&index=0&id=3e69313a&lang=scss&scoped=true&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(false);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".dmap__map[data-v-3e69313a]{display:inline-block;position:relative;width:100%;padding-bottom:100%;vertical-align:top;overflow:hidden}.dmap__map[data-v-3e69313a]  .svg-content{display:inline-block;position:absolute;top:0;left:0}.dmap__map[data-v-3e69313a]  g.town path{fill:#fff;stroke:#cacac9;cursor:pointer}.dmap__map[data-v-3e69313a]  g.district path{fill:transparent;stroke:#8a8c8c;stroke-width:1.2px;pointer-events:none;cursor:pointer}.dmap__map[data-v-3e69313a]  g path.active{fill:rgba(202,235,193,.7529411765)}.dmap__map[data-v-3e69313a]  g.tooltip path{fill:transparent;stroke:#78cc61;stroke-width:3px}.dmap__map[data-v-3e69313a]  .board{margin:1px;border:1px solid #d8d8d8;border-top:6px solid #8dee72;height:calc(100% - 2px);background:#fffffe;display:flex;flex-direction:column;justify-content:space-evenly;align-content:center;text-align:center;cursor:pointer;letter-spacing:1.67px}.dmap__map[data-v-3e69313a]  .board__title{font-weight:300;font-size:.875rem;pointer-events:none}.dmap__map[data-v-3e69313a]  .board__quota{font-weight:500;pointer-events:none}@media screen and (min-width:30em)and (max-width:60em)and (orientation:landscape){.dmap__map[data-v-3e69313a]  .board{border-width:6px 2px 2px}.dmap__map[data-v-3e69313a]  .board__quota,.dmap__map[data-v-3e69313a]  .board__title{transform:scale(1.65)}}\", \"\"]);\n// Exports\nmodule.exports = ___CSS_LOADER_EXPORT___;\n"],"sourceRoot":""}